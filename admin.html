<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovApex â€¢ Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0A0A0F; color: white; font-family: system-ui; }
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-2 bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">
            ðŸš€ NovApex Admin Panel
        </h1>
        <p class="text-gray-400 mb-6">TÃ¼m kullanÄ±cÄ± verileri</p>
        
        <!-- Ä°statistik KartlarÄ± -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div class="glass-card p-4">
                <div class="text-sm text-gray-400">Toplam KullanÄ±cÄ±</div>
                <div class="text-3xl font-bold text-white" id="totalUsers">0</div>
            </div>
            <div class="glass-card p-4">
                <div class="text-sm text-gray-400">Toplam NAPX</div>
                <div class="text-3xl font-bold text-purple-400" id="totalNAPX">0</div>
            </div>
            <div class="glass-card p-4">
                <div class="text-sm text-gray-400">Ortalama NAPX</div>
                <div class="text-3xl font-bold text-blue-400" id="avgNAPX">0</div>
            </div>
            <div class="glass-card p-4">
                <div class="text-sm text-gray-400">En YÃ¼ksek</div>
                <div class="text-3xl font-bold text-green-400" id="maxNAPX">0</div>
            </div>
        </div>
        
        <!-- KullanÄ±cÄ± Tablosu -->
        <div class="glass-card p-4">
            <h2 class="text-xl font-bold mb-4">ðŸ‘¥ KullanÄ±cÄ± Listesi</h2>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="text-left text-gray-400 border-b border-white/10">
                            <th class="pb-3">ID</th>
                            <th class="pb-3">Telegram ID</th>
                            <th class="pb-3">Ä°sim</th>
                            <th class="pb-3">NAPX</th>
                            <th class="pb-3">Seviye</th>
                            <th class="pb-3">KayÄ±t Tarihi</th>
                        </tr>
                    </thead>
                    <tbody id="userTable" class="text-sm">
                        <tr><td colspan="6" class="text-center py-4 text-gray-400">YÃ¼kleniyor...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="text-center mt-4 text-xs text-gray-600">
            Son gÃ¼ncelleme: <span id="updateTime"></span>
        </div>
    </div>

    <script>
        async function loadUsers() {
            try {
                const res = await fetch('/api/get-user-stats');
                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                
                const users = await res.json();
                
                let totalNAPX = 0;
                let maxNAPX = 0;
                let html = '';
                
                if (users.length === 0) {
                    html = '<tr><td colspan="6" class="text-center py-4 text-gray-400">HenÃ¼z kullanÄ±cÄ± yok</td></tr>';
                } else {
                    users.forEach(user => {
                        totalNAPX += user.napx_balance || 0;
                        if (user.napx_balance > maxNAPX) maxNAPX = user.napx_balance;
                        
                        html += `
                            <tr class="border-b border-white/5 hover:bg-white/5">
                                <td class="py-3">${user.id}</td>
                                <td class="py-3 font-mono text-xs">${user.telegram_id ? user.telegram_id.substring(0,8) + '...' : '-'}</td>
                                <td class="py-3">${user.first_name || 'Ä°simsiz'}</td>
                                <td class="py-3 text-purple-400 font-bold">${user.napx_balance || 0}</td>
                                <td class="py-3">${user.level || 'Starter'}</td>
                                <td class="py-3 text-xs text-gray-400">${user.created_at ? new Date(user.created_at).toLocaleDateString('tr-TR') : '-'}</td>
                            </tr>
                        `;
                    });
                }
                
                document.getElementById('totalUsers').textContent = users.length;
                document.getElementById('totalNAPX').textContent = totalNAPX;
                document.getElementById('avgNAPX').textContent = users.length ? Math.round(totalNAPX / users.length) : 0;
                document.getElementById('maxNAPX').textContent = maxNAPX;
                document.getElementById('userTable').innerHTML = html;
                document.getElementById('updateTime').textContent = new Date().toLocaleString('tr-TR');
                
            } catch (error) {
                document.getElementById('userTable').innerHTML = `<tr><td colspan="6" class="text-center py-4 text-red-400">Hata: ${error.message}</td></tr>`;
            }
        }
        
        loadUsers();
        setInterval(loadUsers, 30000);
    </script>
</body>
</html>
