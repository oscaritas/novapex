<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NovApex ‚Ä¢ NAPX</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { font-family: system-ui, -apple-system, sans-serif; }
        body { background: #0A0A0F; color: white; margin: 0; padding: 0; }
        .token-glow { 
            background: linear-gradient(145deg, #8B5CF6, #3B82F6);
            transition: all 0.1s ease;
        }
        .token-glow:active { transform: scale(0.95); }
        .energy-bar { transition: width 0.3s ease; }
    </style>
</head>
<body class="p-4 pb-24">
    <div class="max-w-md mx-auto">
        
        <!-- ========== KULLANICI KARTI ========== -->
        <div class="bg-white/5 rounded-2xl p-4 mb-4 border border-white/10">
            <div class="flex justify-between items-center">
                <div>
                    <div class="text-sm text-gray-400" id="userName">NovApex Ka≈üifi</div>
                    <div class="text-3xl font-black text-white" id="napxBalance">0</div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-gray-400">Seviye</div>
                    <div class="text-xl font-bold text-purple-400" id="userLevel">Starter</div>
                </div>
            </div>
        </div>
        
        <!-- ========== ENERJƒ∞ √áUBUƒûU ========== -->
        <div class="bg-white/5 rounded-xl p-3 mb-4 border border-white/10">
            <div class="flex justify-between text-xs mb-1">
                <span>Enerji</span>
                <span id="energyText">1000/1000</span>
            </div>
            <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden">
                <div id="energyBar" class="energy-bar h-full bg-gradient-to-r from-green-400 to-emerald-400" style="width: 100%"></div>
            </div>
        </div>
        
        <!-- ========== TAP BUTONU ========== -->
        <button id="tapButton" class="token-glow w-full py-8 rounded-2xl text-white text-2xl font-bold mb-6 shadow-2xl">
            TAP ‚Ä¢ +1 NAPX
        </button>
        
        <!-- ========== G√ñREVLER ========== -->
        <div class="mt-6">
            <h2 class="text-lg font-bold text-white mb-3">‚ö° G√∂revler</h2>
            <div id="gorevlerListesi" class="space-y-2">
                <!-- G√∂revler JavaScript ile doldurulacak -->
            </div>
        </div>
        
        <!-- ========== ƒ∞STATƒ∞STƒ∞KLER ========== -->
        <div class="grid grid-cols-2 gap-2 mt-4">
            <div class="bg-white/5 rounded-xl p-3">
                <div class="text-xs text-gray-400">Toplam Tap</div>
                <div class="text-lg font-bold" id="totalTaps">0</div>
            </div>
            <div class="bg-white/5 rounded-xl p-3">
                <div class="text-xs text-gray-400">√áarpan</div>
                <div class="text-lg font-bold text-purple-400" id="multiplier">1.0x</div>
            </div>
        </div>
        
        <!-- ========== ALT NAVIGASYON ========== -->
        <div class="fixed bottom-0 left-0 w-full bg-black/90 border-t border-white/10 p-2 pb-safe">
            <div class="grid grid-cols-4 gap-2 max-w-md mx-auto">
                <button class="py-2 px-1 text-xs text-purple-400">üè† Farm</button>
                <button class="py-2 px-1 text-xs text-gray-500">üìä Earn</button>
                <button class="py-2 px-1 text-xs text-gray-500">üë• Friends</button>
                <button class="py-2 px-1 text-xs text-gray-500">‚öôÔ∏è Stats</button>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // NOVAPEX - MOD√úLER Sƒ∞STEM (Deƒüi≈üime A√ßƒ±k)
        // =============================================
        
        // ---------- AYARLAR (Burasƒ± senin kontrol√ºnde!) ----------
        const ENERJI_AYARLARI = {
            max: 1000,              // Maksimum enerji
            tapEnerji: 1,           // Her tap'te ka√ß enerji gider
            yenilenmeSaniye: 10,    // Ka√ß saniyede 1 enerji gelir
            yenilenmeMiktar: 1       // Ka√ß enerji gelir
        };
        
        const SEVIYELER = [
            { ad: "Starter", minTap: 0, carpan: 1.0, renk: "text-gray-400" },
            { ad: "Bronze", minTap: 100, carpan: 1.2, renk: "text-amber-600" },
            { ad: "Silver", minTap: 500, carpan: 1.5, renk: "text-gray-300" },
            { ad: "Gold", minTap: 1000, carpan: 2.0, renk: "text-yellow-400" },
            { ad: "Platinum", minTap: 5000, carpan: 3.0, renk: "text-blue-400" },
            { ad: "Diamond", minTap: 10000, carpan: 5.0, renk: "text-purple-400" },
            { ad: "Legend", minTap: 50000, carpan: 10.0, renk: "text-red-400" }
        ];
        
        // ---------- G√ñREVLER (ƒ∞stediƒüin kadar ekle/√ßƒ±kar!) ----------
        const GOREVLER = [
            { 
                id: 1, 
                ad: "Telegram Kanalƒ±na Katƒ±l", 
                odul: 50, 
                tip: "link",
                link: "https://t.me/novapex",
                zorluk: "Kolay",
                aktif: true
            },
            { 
                id: 2, 
                ad: "100 Tap Yap", 
                odul: 100, 
                tip: "tap",
                hedef: 100,
                zorluk: "Kolay",
                aktif: true
            },
            { 
                id: 3, 
                ad: "500 Tap Yap", 
                odul: 250, 
                tip: "tap",
                hedef: 500,
                zorluk: "Orta",
                aktif: true
            },
            { 
                id: 4, 
                ad: "Arkada≈ü Davet Et", 
                odul: 500, 
                tip: "referral",
                zorluk: "Zor",
                aktif: true
            },
            { 
                id: 5, 
                ad: "G√ºnde 100 Tap", 
                odul: 200, 
                tip: "daily",
                hedef: 100,
                zorluk: "Orta",
                aktif: true
            }
            // ƒ∞LERƒ∞DE YENƒ∞ G√ñREV EKLEMEK ƒ∞√áƒ∞N:
            // { id: 6, ad: "Yeni G√∂rev", odul: 1000, tip: "...", aktif: true },
        ];
        
        // ---------- KULLANICI VERƒ∞Sƒ∞ ----------
        let userData = {
            napx: 0,
            taps: 0,
            energy: ENERJI_AYARLARI.max,
            tamamlananGorevler: []
        };
        
        const tg = Telegram?.WebApp;
        
        // ---------- SAYFA Y√úKLENƒ∞NCE ----------
        window.onload = function() {
            if (tg) {
                tg.expand();
                tg.ready();
                
                // Telegram kullanƒ±cƒ± adƒ±nƒ± al
                const user = tg.initDataUnsafe?.user;
                if (user?.first_name) {
                    document.getElementById('userName').textContent = user.first_name;
                }
                
                // CloudStorage'dan verileri y√ºkle (KALICI!)
                tg.CloudStorage.getItem('novapex_data', function(err, value) {
                    if (value) {
                        try {
                            const saved = JSON.parse(value);
                            userData.napx = saved.napx || 0;
                            userData.taps = saved.taps || 0;
                            userData.energy = saved.energy ?? ENERJI_AYARLARI.max;
                            userData.tamamlananGorevler = saved.tamamlananGorevler || [];
                        } catch(e) {}
                    }
                    updateScreen();
                    gorevleriGoster();
                });
            }
            
            // Enerji yenilenme zamanlayƒ±cƒ±sƒ±
            setInterval(yenilenEnerji, ENERJI_AYARLARI.yenilenmeSaniye * 1000);
        };
        
        // ---------- TAP BUTONU ----------
        document.getElementById('tapButton').onclick = function() {
            if (userData.energy >= ENERJI_AYARLARI.tapEnerji) {
                // Kazancƒ± hesapla (seviye √ßarpanƒ± ile)
                const seviye = seviyeBul(userData.taps);
                const kazanilan = Math.floor(1 * seviye.carpan);
                
                userData.napx += kazanilan;
                userData.taps += 1;
                userData.energy -= ENERJI_AYARLARI.tapEnerji;
                
                updateScreen();
                kaydet();
                gorevleriKontrolEt('tap');
                
                // Titre≈üim
                if (tg?.HapticFeedback) {
                    tg.HapticFeedback.impactOccurred('light');
                }
            }
        };
        
        // ---------- ENERJƒ∞ YENƒ∞LENME ----------
        function yenilenEnerji() {
            if (userData.energy < ENERJI_AYARLARI.max) {
                userData.energy = Math.min(
                    ENERJI_AYARLARI.max, 
                    userData.energy + ENERJI_AYARLARI.yenilenmeMiktar
                );
                updateScreen();
                kaydet();
            }
        }
        
        // ---------- SEVƒ∞YE BUL ----------
        function seviyeBul(tapSayisi) {
            for (let i = SEVIYELER.length - 1; i >= 0; i--) {
                if (tapSayisi >= SEVIYELER[i].minTap) {
                    return SEVIYELER[i];
                }
            }
            return SEVIYELER[0];
        }
        
        // ---------- EKRANI G√úNCELLE ----------
        function updateScreen() {
            document.getElementById('napxBalance').textContent = userData.napx;
            document.getElementById('totalTaps').textContent = userData.taps;
            
            // Enerji
            const enerjiYuzde = (userData.energy / ENERJI_AYARLARI.max) * 100;
            document.getElementById('energyBar').style.width = enerjiYuzde + '%';
            document.getElementById('energyText').textContent = `${userData.energy}/${ENERJI_AYARLARI.max}`;
            
            // Seviye
            const seviye = seviyeBul(userData.taps);
            document.getElementById('userLevel').textContent = seviye.ad;
            document.getElementById('multiplier').textContent = seviye.carpan + 'x';
        }
        
        // ---------- G√ñREVLERƒ∞ G√ñSTER ----------
        function gorevleriGoster() {
            const container = document.getElementById('gorevlerListesi');
            let html = '';
            
            GOREVLER.forEach(gorev => {
                if (!gorev.aktif) return;
                
                const tamamlandi = userData.tamamlananGorevler.includes(gorev.id);
                const disabled = tamamlandi ? 'opacity-50 pointer-events-none' : '';
                
                html += `
                    <div class="bg-white/5 rounded-xl p-3 border border-white/10 ${disabled}">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-medium">${gorev.ad}</div>
                                <div class="text-xs text-gray-400">+${gorev.odul} NAPX ‚Ä¢ ${gorev.zorluk}</div>
                            </div>
                            <button onclick="gorevYap(${gorev.id})" class="px-3 py-1 bg-purple-500/20 rounded-lg text-xs text-purple-300">
                                ${tamamlandi ? '‚úì Tamamlandƒ±' : 'Yap'}
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // ---------- G√ñREV YAP ----------
        window.gorevYap = function(gorevId) {
            const gorev = GOREVLER.find(g => g.id === gorevId);
            if (!gorev || userData.tamamlananGorevler.includes(gorev.id)) return;
            
            if (gorev.tip === 'link') {
                // Link g√∂revi
                window.open(gorev.link, '_blank');
                
                // √ñd√ºl√º hemen ver
                userData.napx += gorev.odul;
                userData.tamamlananGorevler.push(gorev.id);
                updateScreen();
                kaydet();
                gorevleriGoster();
                
                if (tg?.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('success');
                }
            }
            // Diƒüer g√∂rev tipleri i√ßin kontroller buraya eklenecek
        };
        
        // ---------- G√ñREV KONTROL (Tap bazlƒ±) ----------
        function gorevleriKontrolEt(tip) {
            GOREVLER.forEach(gorev => {
                if (gorev.tip === tip && !userData.tamamlananGorevler.includes(gorev.id)) {
                    if (tip === 'tap' && userData.taps >= gorev.hedef) {
                        // Tap g√∂revi tamamlandƒ±
                        userData.napx += gorev.odul;
                        userData.tamamlananGorevler.push(gorev.id);
                        updateScreen();
                        kaydet();
                        
                        if (tg?.HapticFeedback) {
                            tg.HapticFeedback.notificationOccurred('success');
                        }
                    }
                }
            });
            gorevleriGoster();
        }
        
        // ---------- CLOUDSTORAGE'A KAYDET (KALICI!) ----------
        function kaydet() {
            if (tg) {
                tg.CloudStorage.setItem('novapex_data', JSON.stringify({
                    napx: userData.napx,
                    taps: userData.taps,
                    energy: userData.energy,
                    tamamlananGorevler: userData.tamamlananGorevler
                }));
            }
        }
    </script>
</body>
</html>
