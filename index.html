<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NovApex â€¢ NAPX â€¢ Supabase</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        * { font-family: 'Inter', sans-serif; }
        body { 
            background: #0A0A0F; 
            color: white; 
            margin: 0; 
            padding: 0;
            background: radial-gradient(circle at 30% 10%, rgba(147, 51, 234, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 70% 90%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                        linear-gradient(145deg, #0B1120 0%, #030712 100%);
        }
        .token-glow { 
            background: linear-gradient(145deg, #8B5CF6, #3B82F6);
            transition: all 0.1s ease;
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
        }
        .token-glow:active { transform: scale(0.95); }
        .energy-bar { transition: width 0.3s ease; }
        .farm-progress { transition: width 0.3s ease; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .pulse-animation { animation: pulse 2s infinite; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom, 1rem); }
    </style>
</head>
<body class="p-4 pb-28">
    <div class="max-w-md mx-auto">
        <!-- ========== ÃœST KART ========== -->
        <div class="bg-white/5 backdrop-blur-xl rounded-2xl p-4 mb-3 border border-white/10">
            <div class="flex items-center gap-3 mb-3">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center text-xl font-bold">
                    <span id="userInitial">N</span>
                </div>
                <div class="flex-1">
                    <div class="flex items-center gap-2">
                        <span class="text-sm text-gray-400" id="userName">NovApex KaÅŸifi</span>
                        <span class="text-xs px-2 py-0.5 bg-purple-500/20 rounded-full text-purple-300 border border-purple-500/30" id="userLevelBadge">Starter</span>
                    </div>
                    <div class="flex items-baseline gap-1">
                        <span class="text-3xl font-black text-white" id="napxBalance">0</span>
                        <span class="text-sm text-purple-400">NAPX</span>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-gray-400">SÄ±radaki</div>
                    <div class="text-sm font-bold text-purple-400" id="nextLevel">Bronze</div>
                </div>
            </div>
            <!-- Seviye Progress Bar -->
            <div class="space-y-1">
                <div class="flex justify-between text-xs">
                    <span class="text-gray-400">Seviye Ä°lerlemesi</span>
                    <span id="levelProgressText">0/100</span>
                </div>
                <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden">
                    <div id="levelProgressBar" class="h-full bg-gradient-to-r from-purple-500 to-blue-500" style="width: 0%"></div>
                </div>
            </div>
        </div>
        
        <!-- ========== FARMING KARTI ========== -->
        <div class="bg-white/5 backdrop-blur-xl rounded-2xl p-4 mb-3 border border-purple-500/20 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-24 h-24 bg-purple-600/20 rounded-full blur-3xl"></div>
            <div class="flex justify-between items-start mb-3">
                <div>
                    <div class="text-sm text-gray-400 flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="text-purple-400">
                            <path d="M128,44a96,96,0,1,0,96,96A96.11,96.11,0,0,0,128,44Zm0,168a72,72,0,1,1,72-72A72.08,72.08,0,0,1,128,212ZM164.49,99.51a12,12,0,0,1,0,17l-28,28a12,12,0,0,1-17-17l28-28A12,12,0,0,1,164.49,99.51ZM92,16A12,12,0,0,1,104,4h48a12,12,0,0,1,0,24H104A12,12,0,0,1,92,16Z"></path>
                        </svg>
                        <span>Farming Status</span>
                    </div>
                    <div class="flex items-end gap-2">
                        <span class="text-3xl font-bold text-white" id="farmedAmount">0</span>
                        <span class="text-sm text-gray-400 mb-1">NAPX</span>
                    </div>
                </div>
                <div class="flex items-center gap-1 px-2 py-1 bg-emerald-500/20 rounded-full">
                    <div class="w-2 h-2 rounded-full bg-emerald-400 pulse-animation"></div>
                    <span class="text-xs text-emerald-400">Active</span>
                </div>
            </div>
            <!-- Farming Ä°lerleme Ã‡ubuÄŸu -->
            <div class="mb-4">
                <div class="flex justify-between text-xs mb-1">
                    <span class="text-gray-400">Claim'e kalan</span>
                    <span class="text-white font-mono" id="claimTimer">01:00:00</span>
                </div>
                <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden">
                    <div id="farmProgress" class="farm-progress h-full bg-gradient-to-r from-yellow-400 to-amber-500" style="width: 0%"></div>
                </div>
            </div>
            <!-- Claim ve Boost ButonlarÄ± -->
            <div class="grid grid-cols-2 gap-2">
                <button id="claimButton" class="py-3 rounded-xl font-medium bg-gradient-to-r from-purple-600 to-blue-600 text-white disabled:opacity-50 disabled:cursor-not-allowed">
                    Claim
                </button>
                <button id="boostButton" class="py-3 rounded-xl font-medium bg-white/10 border border-white/20 text-white">
                    ğŸš€ Boost
                </button>
            </div>
        </div>
        
        <!-- ========== ENERJÄ° Ã‡UBUÄU ========== -->
        <div class="bg-white/5 backdrop-blur-xl rounded-xl p-3 mb-3 border border-white/10">
            <div class="flex justify-between text-xs mb-1">
                <span class="text-gray-400">Enerji</span>
                <span id="energyText">1000/1000</span>
            </div>
            <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden">
                <div id="energyBar" class="energy-bar h-full bg-gradient-to-r from-green-400 to-emerald-400" style="width: 100%"></div>
            </div>
        </div>
        
        <!-- ========== TAP BUTONU ========== -->
        <button id="tapButton" class="token-glow w-full py-8 rounded-2xl text-white text-2xl font-bold mb-4 shadow-2xl">
            <div class="flex flex-col items-center">
                <span class="text-3xl">ğŸ‘† TAP</span>
                <span class="text-sm opacity-80" id="tapKazanc">+1 NAPX</span>
            </div>
        </button>
        
        <!-- ========== HIZLI Ä°ÅLEMLER ========== -->
        <div class="grid grid-cols-4 gap-2 mb-4">
            <button class="bg-white/5 backdrop-blur-xl rounded-xl p-3 border border-white/10 flex flex-col items-center">
                <span class="text-2xl mb-1">ğŸ</span>
                <span class="text-xs">GÃ¼nlÃ¼k</span>
            </button>
            <button id="tasksButton" class="bg-white/5 backdrop-blur-xl rounded-xl p-3 border border-white/10 flex flex-col items-center">
                <span class="text-2xl mb-1">ğŸ“‹</span>
                <span class="text-xs">GÃ¶revler</span>
            </button>
            <button id="referralButton" class="bg-white/5 backdrop-blur-xl rounded-xl p-3 border border-white/10 flex flex-col items-center">
                <span class="text-2xl mb-1">ğŸ‘¥</span>
                <span class="text-xs">Davet</span>
            </button>
            <button class="bg-white/5 backdrop-blur-xl rounded-xl p-3 border border-white/10 flex flex-col items-center">
                <span class="text-2xl mb-1">ğŸ°</span>
                <span class="text-xs">Spin</span>
            </button>
        </div>
        
        <!-- ========== GÃ–REVLER ========== -->
        <div id="tasksSection" class="bg-white/5 backdrop-blur-xl rounded-2xl p-4 mb-3 border border-white/10 hidden">
            <div class="flex justify-between items-center mb-3">
                <h2 class="font-bold">âš¡ GÃ¶revler</h2>
                <button id="closeTasks" class="text-xs text-gray-400">âœ• Kapat</button>
            </div>
            <div id="gorevlerListesi" class="space-y-2 max-h-80 overflow-y-auto"></div>
        </div>
        
        <!-- ========== DAVET BÃ–LÃœMÃœ ========== -->
        <div id="referralSection" class="bg-white/5 backdrop-blur-xl rounded-2xl p-4 mb-3 border border-white/10 hidden">
            <div class="flex justify-between items-center mb-3">
                <h2 class="font-bold">ğŸ‘¥ ArkadaÅŸlarÄ±nÄ± Davet Et</h2>
                <button id="closeReferral" class="text-xs text-gray-400">âœ• Kapat</button>
            </div>
            
            <div class="grid grid-cols-2 gap-2 mb-3">
                <div class="bg-white/10 rounded-xl p-2 text-center">
                    <div class="text-xs text-gray-400">Toplam Davet</div>
                    <div class="text-lg font-bold text-purple-400" id="totalReferrals">0</div>
                </div>
                <div class="bg-white/10 rounded-xl p-2 text-center">
                    <div class="text-xs text-gray-400">KazanÄ±lan</div>
                    <div class="text-lg font-bold text-green-400" id="referralEarnings">0</div>
                </div>
            </div>
            
            <div class="mb-3">
                <div class="text-xs text-gray-400 mb-1">Senin Ã¶zel davet linkin:</div>
                <div class="flex gap-2">
                    <input type="text" id="referralLink" readonly class="flex-1 bg-white/10 border border-white/20 rounded-xl px-3 py-2 text-sm text-white" value="YÃ¼kleniyor...">
                    <button id="copyLinkButton" class="bg-purple-500/20 border border-purple-500/30 rounded-xl px-3 text-purple-300 text-sm">Kopyala</button>
                </div>
            </div>
            
            <div class="text-xs text-gray-400 bg-white/5 p-2 rounded-lg">
                <span class="text-purple-400">ğŸ’° +500 NAPX</span> her davette<br>
                <span class="text-purple-400">ğŸ +200 NAPX</span> arkadaÅŸÄ±n ilk tap'inde
            </div>
        </div>
        
        <!-- ========== Ä°STATÄ°STÄ°KLER ========== -->
        <div class="grid grid-cols-3 gap-2">
            <div class="bg-white/5 backdrop-blur-xl rounded-xl p-2 text-center">
                <div class="text-xs text-gray-400">Toplam Tap</div>
                <div class="text-base font-bold" id="totalTaps">0</div>
            </div>
            <div class="bg-white/5 backdrop-blur-xl rounded-xl p-2 text-center">
                <div class="text-xs text-gray-400">Saatlik</div>
                <div class="text-base font-bold text-purple-400" id="hourlyRate">9</div>
            </div>
            <div class="bg-white/5 backdrop-blur-xl rounded-xl p-2 text-center">
                <div class="text-xs text-gray-400">Ã‡arpan</div>
                <div class="text-base font-bold text-blue-400" id="multiplier">1.0x</div>
            </div>
        </div>
        
        <!-- ========== ALT NAVIGASYON ========== -->
        <nav class="fixed bottom-0 left-0 w-full bg-black/90 backdrop-blur-xl border-t border-purple-500/20 pb-safe z-50">
            <div class="grid grid-cols-5 gap-1 max-w-md mx-auto py-1">
                <button class="flex flex-col items-center p-2 text-purple-400">ğŸ <span class="text-[10px]">Farm</span></button>
                <button class="flex flex-col items-center p-2 text-gray-500">ğŸ“Š<span class="text-[10px]">Earn</span></button>
                <button class="flex flex-col items-center p-2 text-gray-500">ğŸ‘‘<span class="text-[10px]">Leaders</span></button>
                <button class="flex flex-col items-center p-2 text-gray-500">ğŸ‘¥<span class="text-[10px]">Friends</span></button>
                <button class="flex flex-col items-center p-2 text-gray-500">ğŸ’°<span class="text-[10px]">Token</span></button>
            </div>
        </nav>
    </div>

    <script>
        // =============================================
        // NOVAPEX - SUPABASE ENTEGRE SON VERSÄ°YON
        // =============================================
        
        const ENERJI_AYARLARI = { max: 1000, tapEnerji: 1, yenilenmeSaniye: 10, yenilenmeMiktar: 1 };
        const FARM_AYARLARI = { saatlikKazanc: 9, claimSuresi: 3600, maxFarm: 216 };
        const API_BASE = 'https://novapex.vercel.app/api';
        const KANAL_LINKI = "https://t.me/novapex_official";
        
        const SEVIYELER = [
            { ad: "Starter", minTap: 0, carpan: 1.0, next: 100, saatlik: 9 },
            { ad: "Bronze", minTap: 100, carpan: 1.2, next: 500, saatlik: 12 },
            { ad: "Silver", minTap: 500, carpan: 1.5, next: 1000, saatlik: 15 },
            { ad: "Gold", minTap: 1000, carpan: 2.0, next: 5000, saatlik: 20 },
            { ad: "Platinum", minTap: 5000, carpan: 3.0, next: 10000, saatlik: 30 },
            { ad: "Diamond", minTap: 10000, carpan: 5.0, next: 50000, saatlik: 50 },
            { ad: "Legend", minTap: 50000, carpan: 10.0, next: null, saatlik: 100 }
        ];
        
        const GOREVLER = [
            { id: 1, ad: "Telegram KanalÄ±na KatÄ±l", odul: 50, tip: "link", link: KANAL_LINKI, aktif: true },
            { id: 2, ad: "100 Tap Yap", odul: 100, tip: "tap", hedef: 100, aktif: true },
            { id: 3, ad: "500 Tap Yap", odul: 250, tip: "tap", hedef: 500, aktif: true },
            { id: 4, ad: "Ä°lk Claim'i Yap", odul: 100, tip: "claim", aktif: true },
            { id: 5, ad: "ArkadaÅŸ Davet Et", odul: 500, tip: "referral", aktif: true },
            { id: 6, ad: "GÃ¼nde 100 Tap", odul: 200, tip: "daily", hedef: 100, aktif: true }
        ];
        
        let userData = {
            napx: 0, taps: 0, energy: 1000, farmed: 0, lastClaim: null,
            tamamlananGorevler: [], referrals: [], totalReferrals: 0,
            referralEarnings: 0, userId: null, firstTapDone: false
        };
        
        const tg = Telegram?.WebApp;
        let claimInterval;
        
        window.onload = function() {
            if (tg) {
                tg.expand(); tg.ready();
                const user = tg.initDataUnsafe?.user;
                if (user?.id) {
                    userData.userId = user.id.toString();
                    if (user.first_name) {
                        document.getElementById('userName').textContent = user.first_name;
                        document.getElementById('userInitial').textContent = user.first_name.charAt(0);
                    }
                    updateReferralLink();
                }
                
                tg.CloudStorage.getItem('novapex_supabase', function(err, value) {
                    if (value) {
                        try { 
                            const saved = JSON.parse(value); 
                            userData = {...userData, ...saved}; 
                        } catch(e) {}
                    }
                    if (!userData.lastClaim) userData.lastClaim = Date.now();
                    updateScreen(); gorevleriGoster(); startFarmTimer(); checkForReferral();
                });
            }
            
            setInterval(yenilenEnerji, ENERJI_AYARLARI.yenilenmeSaniye * 1000);
            
            document.getElementById('claimButton').onclick = claimFarm;
            document.getElementById('boostButton').onclick = () => alert('Boost yakÄ±nda!');
            document.getElementById('tapButton').onclick = tap;
            
            document.getElementById('tasksButton').onclick = () => {
                document.getElementById('tasksSection').classList.remove('hidden');
                document.getElementById('referralSection').classList.add('hidden');
            };
            document.getElementById('closeTasks').onclick = () => {
                document.getElementById('tasksSection').classList.add('hidden');
            };
            
            document.getElementById('referralButton').onclick = () => {
                document.getElementById('referralSection').classList.remove('hidden');
                document.getElementById('tasksSection').classList.add('hidden');
            };
            document.getElementById('closeReferral').onclick = () => {
                document.getElementById('referralSection').classList.add('hidden');
            };
            
            document.getElementById('copyLinkButton').onclick = copyReferralLink;
        };
        
        function updateReferralLink() {
            if (userData.userId) {
                document.getElementById('referralLink').value = 
                    `https://t.me/NovApex_Official_Bot?start=${userData.userId}`;
            }
        }
        
        function copyReferralLink() {
            const link = document.getElementById('referralLink');
            link.select(); navigator.clipboard?.writeText(link.value);
            if (tg?.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            alert('âœ… Davet linki kopyalandÄ±!');
        }
        
        function checkForReferral() {
            const startParam = tg?.initDataUnsafe?.start_param;
            if (startParam && startParam !== userData.userId && !userData.referrals.includes(startParam)) {
                fetch(`${API_BASE}/referral`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ referrerId: startParam, newUserId: userData.userId })
                }).then(res => res.json()).then(data => {
                    if (data.success) {
                        userData.referrals.push(startParam);
                        userData.totalReferrals++;
                        userData.referralEarnings += 500;
                        kaydet(); updateScreen();
                        if (tg?.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                    }
                }).catch(err => console.log(err));
            }
        }
        
        function checkFirstTap() {
            if (!userData.firstTapDone && userData.taps === 1 && userData.referrals.length > 0) {
                userData.firstTapDone = true;
                fetch(`${API_BASE}/claim-reward`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: userData.referrals[0], type: 'first_tap' })
                }).then(res => res.json()).then(data => {
                    if (data.success) {
                        userData.referralEarnings += 200;
                        kaydet(); updateScreen();
                    }
                });
            }
        }
        
        function tap() {
            if (userData.energy >= ENERJI_AYARLARI.tapEnerji) {
                const seviye = seviyeBul(userData.taps);
                const kazanilan = Math.floor(1 * seviye.carpan);
                userData.napx += kazanilan;
                userData.taps++;
                userData.energy -= ENERJI_AYARLARI.tapEnerji;
                updateScreen(); kaydet(); gorevleriKontrolEt('tap'); checkFirstTap();
                if (tg?.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            }
        }
        
        function startFarmTimer() {
            if (claimInterval) clearInterval(claimInterval);
            claimInterval = setInterval(() => {
                if (!userData.lastClaim) userData.lastClaim = Date.now();
                const gecenSaniye = Math.floor((Date.now() - userData.lastClaim) / 1000);
                const seviye = seviyeBul(userData.taps);
                const saatlik = seviye.saatlik || 9;
                const progress = (gecenSaniye / FARM_AYARLARI.claimSuresi) * 100;
                document.getElementById('farmProgress').style.width = Math.min(100, progress) + '%';
                userData.farmed = Math.min(Math.floor((gecenSaniye / 3600) * saatlik), FARM_AYARLARI.maxFarm);
                const kalan = Math.max(0, FARM_AYARLARI.claimSuresi - gecenSaniye);
                const h = Math.floor(kalan / 3600);
                const m = Math.floor((kalan % 3600) / 60);
                const s = kalan % 60;
                document.getElementById('claimTimer').textContent = 
                    `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                document.getElementById('farmedAmount').textContent = userData.farmed;
                document.getElementById('claimButton').disabled = kalan > 0;
            }, 1000);
        }
        
        function claimFarm() {
            if (userData.farmed > 0) {
                userData.napx += userData.farmed;
                userData.lastClaim = Date.now();
                userData.farmed = 0;
                updateScreen(); kaydet(); gorevleriKontrolEt('claim');
                if (tg?.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            }
        }
        
        function yenilenEnerji() {
            if (userData.energy < ENERJI_AYARLARI.max) {
                userData.energy = Math.min(ENERJI_AYARLARI.max, userData.energy + 1);
                updateScreen(); kaydet();
            }
        }
        
        function seviyeBul(tap) {
            for (let i = SEVIYELER.length - 1; i >= 0; i--) 
                if (tap >= SEVIYELER[i].minTap) return SEVIYELER[i];
            return SEVIYELER[0];
        }
        
        function updateScreen() {
            document.getElementById('napxBalance').textContent = userData.napx;
            document.getElementById('totalTaps').textContent = userData.taps;
            const enerjiYuzde = (userData.energy / ENERJI_AYARLARI.max) * 100;
            document.getElementById('energyBar').style.width = enerjiYuzde + '%';
            document.getElementById('energyText').textContent = `${userData.energy}/${ENERJI_AYARLARI.max}`;
            const seviye = seviyeBul(userData.taps);
            document.getElementById('userLevelBadge').textContent = seviye.ad;
            document.getElementById('multiplier').textContent = seviye.carpan + 'x';
            document.getElementById('hourlyRate').textContent = seviye.saatlik || 9;
            document.getElementById('tapKazanc').textContent = `+${Math.floor(1 * seviye.carpan)} NAPX`;
            const siradaki = SEVIYELER.find(s => s.minTap > userData.taps) || SEVIYELER[SEVIYELER.length-1];
            document.getElementById('nextLevel').textContent = siradaki?.ad || 'Max';
            const index = SEVIYELER.findIndex(s => s.ad === seviye.ad);
            const sonraki = SEVIYELER[index + 1];
            if (sonraki) {
                const progress = ((userData.taps - seviye.minTap) / (sonraki.minTap - seviye.minTap)) * 100;
                document.getElementById('levelProgressBar').style.width = Math.min(100, progress) + '%';
                document.getElementById('levelProgressText').textContent = 
                    `${userData.taps - seviye.minTap}/${sonraki.minTap - seviye.minTap}`;
            } else {
                document.getElementById('levelProgressBar').style.width = '100%';
                document.getElementById('levelProgressText').textContent = 'Max Seviye';
            }
            document.getElementById('totalReferrals').textContent = userData.totalReferrals || 0;
            document.getElementById('referralEarnings').textContent = userData.referralEarnings || 0;
        }
        
        function gorevleriGoster() {
            let html = '';
            GOREVLER.forEach(g => {
                if (!g.aktif) return;
                const tamam = userData.tamamlananGorevler.includes(g.id);
                html += `
                    <div class="bg-white/5 rounded-xl p-3 border border-white/10 ${tamam ? 'opacity-50' : ''}">
                        <div class="flex justify-between items-center">
                            <div><div class="font-medium text-sm">${g.ad}</div><div class="text-xs text-gray-400">+${g.odul} NAPX</div></div>
                            <button onclick="gorevYap(${g.id})" class="px-3 py-1.5 bg-purple-500/20 rounded-lg text-xs text-purple-300">
                                ${tamam ? 'âœ“ TamamlandÄ±' : 'Git'}
                            </button>
                        </div>
                    </div>
                `;
            });
            document.getElementById('gorevlerListesi').innerHTML = html;
        }
        
        window.gorevYap = function(id) {
            const gorev = GOREVLER.find(g => g.id === id);
            if (!gorev || userData.tamamlananGorevler.includes(id)) return;
            if (gorev.tip === 'link') {
                window.open(gorev.link, '_blank');
                userData.napx += gorev.odul;
                userData.tamamlananGorevler.push(id);
                updateScreen(); kaydet(); gorevleriGoster();
                if (tg?.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
            }
        };
        
        function gorevleriKontrolEt(tip) {
            GOREVLER.forEach(g => {
                if (g.tip === tip && !userData.tamamlananGorevler.includes(g.id)) {
                    if (tip === 'tap' && userData.taps >= g.hedef) {
                        userData.napx += g.odul;
                        userData.tamamlananGorevler.push(g.id);
                        updateScreen(); kaydet(); gorevleriGoster();
                        if (tg?.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
                    }
                    if (tip === 'claim' && !userData.tamamlananGorevler.includes(4)) {
                        userData.napx += g.odul;
                        userData.tamamlananGorevler.push(4);
                        updateScreen(); kaydet(); gorevleriGoster();
                    }
                }
            });
        }
        
        function kaydet() {
            if (tg) {
                tg.CloudStorage.setItem('novapex_supabase', JSON.stringify({
                    napx: userData.napx, taps: userData.taps, energy: userData.energy,
                    lastClaim: userData.lastClaim, tamamlananGorevler: userData.tamamlananGorevler,
                    referrals: userData.referrals, totalReferrals: userData.totalReferrals,
                    referralEarnings: userData.referralEarnings, firstTapDone: userData.firstTapDone
                }));
            }
        }
    </script>
</body>
</html>
